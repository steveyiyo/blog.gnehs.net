<!doctype html><html lang><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>一起來幫網站加入 reCAPTCHA 吧 - 勝勝</title><meta name=description content="reCAPTCHA 是眾所皆知的工人 OCR 驗證系統，在 v3 中，直接由分數判斷是否是機器人，因此也不需要核取方塊了。
最近在幫 Telegram 蒐集君 寫提交工具，因為驗證碼很麻煩，自己也懶得打所以直接拿 reCAPTCHA 來用了，由於使用 XHR 提交資料，因此 reCAPTCHA 的部分需要稍稍改寫才能夠正常運作。
始步：在 reCAPTCHA 註冊新的網站 要使用 reCAPTCHA，必須要先到 Google 註冊才能夠使用，以下是註冊流程。
註冊新網站：https://www.google.com/recaptcha/admin/create
標籤：填入自己方便記憶的名稱即可
類型：選 v3
網域：輸入自己要用的網域，如果你要在本地測試，可以再加上 localhost
全部輸入完成後按下下方的「提交」即可
註冊完成後，你會拿到兩串金鑰，請好好保存，其中密鑰不能給他人知道。
加入 reCAPTCHA 到前端頁面吧！ 把下面的程式碼貼到你的網頁中吧！別忘了將 reCAPTCHA_site_key 換成你的網站金鑰
<script src=&#34;https://www.google.com/recaptcha/api.js?render=reCAPTCHA_site_key&#34;></script> <script> grecaptcha.ready(function() { grecaptcha.execute('reCAPTCHA_site_key', {action: 'homepage'}).then(token => { //這裡拿到的 token 要在 XHR 請求時也發給伺服器驗證 }); }); </script> 完成後，應該就能在網頁右下角看見 reCAPTCHA 的標誌了
完成後端驗證 發送請求的方式百百種，因為我的後端語言用 node.js 所以就拿 request-promise 來送請求。
*請自行修改程式碼以符合需求
const rp = require(&#34;request-promise&#34;) let result = await rp({ method: 'post', uri: &#34;https://www."><meta name=author content="勝勝"><link href=https://blog.gnehs.net/an-old-hope.min.css rel=stylesheet><link href=https://blog.gnehs.net/style.css rel=stylesheet><link href=https://blog.gnehs.net/custom.css rel=stylesheet><link rel=apple-touch-icon href=/favicon.png><link rel=icon href=/favicon.png><meta name=generator content="Hugo 0.81.0"><script>function setTheme(){if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');return}const c=new Date,g=localStorage.getItem('date'),d=String(c.getMonth()+1)+'.'+String(c.getDate()),e=c.getTime();let a,b;function f(){if(e>a&&e<b)return;document.body.classList.add('dark')}d!==g?(fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215').then(a=>a.json()).then(c=>{a=c.sunrise.split(':').map(Number),b=c.sunset.split(':').map(Number)}).catch(()=>{a=[7,0],b=[19,0]}).finally(()=>{a=c.setHours(a[0],a[1],0),b=c.setHours(b[0],b[1],0),f(),localStorage.setItem('sunrise',a),localStorage.setItem('sunset',b)}),localStorage.setItem('date',d)):(a=Number(localStorage.getItem('sunrise')),b=Number(localStorage.getItem('sunset')),f())}</script></head><body class=single><script>setTheme()</script><header class=header><nav class=nav><p class=logo><a href=https://blog.gnehs.net>勝勝</a></p><ul class=menu><li><a href=/categories/>categories</a></li><li><a href=/tags/>tags</a></li><li><a href=/about/>about</a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>一起來幫網站加入 reCAPTCHA 吧</h1><div class=post-meta>勝勝 · 2019 年 05 月 05 日</div></header><div class=post-content><p>reCAPTCHA 是眾所皆知的工人 OCR 驗證系統，在 v3 中，直接由分數判斷是否是機器人，因此也不需要核取方塊了。</p><p>最近在幫 <a href=https://tg.gnehs.net>Telegram 蒐集君</a> 寫提交工具，因為驗證碼很麻煩，自己也懶得打所以直接拿 reCAPTCHA 來用了，由於使用 XHR 提交資料，因此 reCAPTCHA 的部分需要稍稍改寫才能夠正常運作。</p><h2 id=始步在-recaptcha-註冊新的網站>始步：在 reCAPTCHA 註冊新的網站</h2><p>要使用 reCAPTCHA，必須要先到 Google 註冊才能夠使用，以下是註冊流程。</p><p>註冊新網站：<a href=https://www.google.com/recaptcha/admin/create></a><a href=https://www.google.com/recaptcha/admin/create>https://www.google.com/recaptcha/admin/create</a></p><p>標籤：填入自己方便記憶的名稱即可<br>類型：選 v3<br>網域：輸入自己要用的網域，如果你要在本地測試，可以再加上 localhost</p><p><img src=https://i.imgur.com/LfFj8pL.png alt></p><p>全部輸入完成後按下下方的「提交」即可</p><p><img src=https://i.imgur.com/O5g0iGl.jpg alt></p><p>註冊完成後，你會拿到兩串金鑰，請好好保存，其中密鑰不能給他人知道。</p><h2 id=加入-recaptcha-到前端頁面吧>加入 reCAPTCHA 到前端頁面吧！</h2><p>把下面的程式碼貼到你的網頁中吧！別忘了將 reCAPTCHA_site_key 換成你的網站金鑰</p><pre><code>&lt;script src=&quot;https://www.google.com/recaptcha/api.js?render=reCAPTCHA_site_key&quot;&gt;&lt;/script&gt;

&lt;script&gt;
grecaptcha.ready(function() {
    grecaptcha.execute('reCAPTCHA_site_key', {action: 'homepage'}).then(token =&gt; {
       //這裡拿到的 token 要在 XHR 請求時也發給伺服器驗證
    });
});
&lt;/script&gt;
</code></pre><p><img src=https://i.imgur.com/BeJYwd8.png alt></p><p>完成後，應該就能在網頁右下角看見 reCAPTCHA 的標誌了</p><h2 id=完成後端驗證>完成後端驗證</h2><p>發送請求的方式百百種，因為我的後端語言用 node.js 所以就拿 <a href=https://github.com/request/request-promise>request-promise</a> 來送請求。<br><em>*請自行修改程式碼以符合需求</em></p><pre><code>const rp = require(&quot;request-promise&quot;)
let result = await rp({
    method: 'post',
    uri: &quot;https://www.google.com/recaptcha/api/siteverify&quot;,
    qs: {
        secret: reCAPTCHA_secret_key, //你的密鑰
        response: token //前端送來的 token
    },
    transform: x =&gt; JSON.parse(x)
})
// 驗證失敗
if (!result.success) return res.json(result)
</code></pre><p>提交工具也有在 GitHub 上開源，尼也可以參考其中的程式碼<br><a href=https://github.com/gnehs/tg-submit></a><a href=https://github.com/gnehs/tg-submit>https://github.com/gnehs/tg-submit</a></p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.gnehs.net/tags/node>node</a></li><li><a href=https://blog.gnehs.net/tags/recaptcha>reCAPTCHA</a></li><li><a href=https://blog.gnehs.net/tags/%E6%95%99%E5%AD%B8>教學</a></li></ul></footer><br><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-6834090314855499 data-ad-slot=2767030263></ins></article></main><footer class=footer><span>&copy; 2021 <a href=https://blog.gnehs.net>勝勝</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper</a></span></footer><script src=https://blog.gnehs.net/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-96NRMGGV7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-96NRMGGV7E')</script></body></html>