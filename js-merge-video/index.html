<!doctype html><html lang><head><meta charset=utf-8><meta http-equiv=x-ua-compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1,shrink-to-fit=no"><title>如何使用 Javascript 將多部影片混合為一個影片 - 勝勝</title><meta name=description content="最近在製作 How 發聲器 因為影片每個發音播放時都會有間隙，超討厭，但 How哥產生器 聽說是用 ffmpeg 來做輸出，要後端而且看起來很燒錢，所以在尋找純前端的做法。
我先說，這真的有夠搞剛，超級無敵麻煩，另外，如果你用 Node.js 用 fluent-ffmpeg 就好了。
在尋找的時候看到這個 How do i append two video files data to a source buffer using media source api? ，而且下面的 解法 還會動，甚至支援不同尺寸影片混合，所以我把它偷過來就好了嗎。
錯誤！ 他根本不會動，只知道不停地噴錯，明明我放的跟他一樣都是 MP4，我完全不知道他 Demo 怎麼會動 解法 在網路上尋找不同解法後，看了這篇文章「Transcoding assets for Media Source Extensions」，發現是 MP4 少了幾個 Flag 以及 codec 要自己拿 MP4Box 看了之後填進程式碼，拿 ffmpeg 處理過後就會動了。
結果處理時加這行就好了 -movflags frag_keyframe+empty_moov+default_base_moof ，害我花了快半天，真棒 Demo 你可以使用 Chrome 查看 How 發聲器
雖然有點音聲不同步，算了隨便啦"><meta name=author content="勝勝"><link href=https://blog.gnehs.net/an-old-hope.min.css rel=stylesheet><link href=https://blog.gnehs.net/style.css rel=stylesheet><link href=https://blog.gnehs.net/custom.css rel=stylesheet><link rel=apple-touch-icon href=/favicon.png><link rel=icon href=/favicon.png><meta name=generator content="Hugo 0.81.0"><script>function setTheme(){if(window.matchMedia('(prefers-color-scheme: dark)').matches){document.body.classList.add('dark');return}const c=new Date,g=localStorage.getItem('date'),d=String(c.getMonth()+1)+'.'+String(c.getDate()),e=c.getTime();let a,b;function f(){if(e>a&&e<b)return;document.body.classList.add('dark')}d!==g?(fetch('https://api.ipgeolocation.io/astronomy?apiKey=5ed37d85103e4defa5df4c5298ed5215').then(a=>a.json()).then(c=>{a=c.sunrise.split(':').map(Number),b=c.sunset.split(':').map(Number)}).catch(()=>{a=[7,0],b=[19,0]}).finally(()=>{a=c.setHours(a[0],a[1],0),b=c.setHours(b[0],b[1],0),f(),localStorage.setItem('sunrise',a),localStorage.setItem('sunset',b)}),localStorage.setItem('date',d)):(a=Number(localStorage.getItem('sunrise')),b=Number(localStorage.getItem('sunset')),f())}</script></head><body class=single><script>setTheme()</script><header class=header><nav class=nav><p class=logo><a href=https://blog.gnehs.net>勝勝</a></p><ul class=menu><li><a href=/categories/>categories</a></li><li><a href=/tags/>tags</a></li><li><a href=/about/>about</a></li></ul></nav></header><main class=main><article class=post-single><header class=post-header><h1 class=post-title>如何使用 Javascript 將多部影片混合為一個影片</h1><div class=post-meta>勝勝 · 2020 年 06 月 06 日</div></header><div class=post-content><p>最近在製作 <a href="https://howfun.futa.gg/?text=%E9%9F%93%E5%9C%8B%E7%91%9C%E6%8E%B0%E6%8E%B0">How 發聲器</a> 因為影片每個發音播放時都會有間隙，超討厭，但 <a href="https://howger.orange.tw/?mode=share&id=5edbb61209015">How哥產生器</a> 聽說是用 ffmpeg 來做輸出，要後端而且看起來很燒錢，所以在尋找純前端的做法。</p><p>我先說，這真的有夠搞剛，超級無敵麻煩，另外，如果你用 Node.js 用 fluent-ffmpeg 就好了。</p><p>在尋找的時候看到這個 <a href=https://stackoverflow.com/a/18026530>How do i append two video files data to a source buffer using media source api?</a> ，而且下面的 <a href="http://plnkr.co/edit/KBbopiad1wR25nqtrvxw?p=preview&preview">解法</a> 還會動，甚至支援不同尺寸影片混合，所以我把它偷過來就好了嗎。</p><h2 id=錯誤>錯誤！</h2><p>他根本不會動，只知道不停地噴錯，明明我放的跟他一樣都是 MP4，我完全不知道他 Demo 怎麼會動 <img src=https://i.imgur.com/srj2fND.png alt></p><h2 id=解法>解法</h2><p>在網路上尋找不同解法後，看了這篇文章「<a href=https://developer.mozilla.org/en-US/docs/Web/API/Media_Source_Extensions_API/Transcoding_assets_for_MSE>Transcoding assets for Media Source Extensions</a>」，發現是 MP4 少了幾個 Flag 以及 codec 要自己拿 MP4Box 看了之後填進程式碼，拿 ffmpeg 處理過後就會動了。</p><p>結果處理時加這行就好了 <code>-movflags frag_keyframe+empty_moov+default_base_moof</code> ，害我花了快半天，真棒 <img src=https://i.imgur.com/5XRJEnK.png alt></p><h2 id=demo>Demo</h2><p>你可以使用 Chrome 查看 <a href="https://howfun.futa.gg/?text=%E9%9F%93%E5%9C%8B%E7%91%9C%E6%8E%B0%E6%8E%B0">How 發聲器</a></p><p>雖然有點音聲不同步，算了隨便啦</p></div><footer class=post-footer><ul class=post-tags><li><a href=https://blog.gnehs.net/tags/%E6%95%99%E5%AD%B8>教學</a></li></ul></footer><br><ins class=adsbygoogle style=display:block;text-align:center data-ad-layout=in-article data-ad-format=fluid data-ad-client=ca-pub-6834090314855499 data-ad-slot=2767030263></ins></article></main><footer class=footer><span>&copy; 2021 <a href=https://blog.gnehs.net>勝勝</a></span>
<span>&#183;</span>
<span>Powered by <a href=https://gohugo.io/ rel=noopener target=_blank>Hugo️️</a>️</span>
<span>&#183;</span>
<span>Theme️ <a href=https://github.com/nanxiaobei/hugo-paper rel=noopener target=_blank>Paper</a></span></footer><script src=https://blog.gnehs.net/highlight.min.js></script><script>hljs.initHighlightingOnLoad()</script><script async src=https://pagead2.googlesyndication.com/pagead/js/adsbygoogle.js></script><script>(adsbygoogle=window.adsbygoogle||[]).push({})</script><script async src="https://www.googletagmanager.com/gtag/js?id=G-96NRMGGV7E"></script><script>window.dataLayer=window.dataLayer||[];function gtag(){dataLayer.push(arguments)}gtag('js',new Date),gtag('config','G-96NRMGGV7E')</script></body></html>